/*!
 * 
 * blue-pend.js 1.0.4
 * (c) 2016-2022 Blue
 * Released under the MIT License.
 * https://github.com/azhanging/blue-pend
 * time:Tue, 02 Aug 2022 15:48:50 GMT
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("blue-queue-pipe")):"function"==typeof define&&define.amd?define(["blue-queue-pipe"],t):"object"==typeof exports?exports.BluePend=t(require("blue-queue-pipe")):e.BluePend=t(e.BlueQuePipe)}("undefined"!=typeof self?self:this,function(e){return function(e){var t={};function n(u){if(t[u])return t[u].exports;var i=t[u]={i:u,l:!1,exports:{}};return e[u].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,u){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:u})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var u=Object.create(null);if(n.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(u,i,function(t){return e[t]}.bind(null,i));return u},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./static",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var u=n(1),i=n.n(u),o=n(2);var r="DEFAULT",s=function(){function e(e){void 0===e&&(e={}),this.options=e,this.key=e.key||r,this.pends={}}return e.prototype.hook=function(e,t,n){return void 0===n&&(n=[]),"function"==typeof t?t.apply(e,n):t},e.prototype.statusHook=function(e){var t=this;void 0===e&&(e={});for(var n=e.key,u=void 0===n?this.key:n,i=e.create,r=e.success,s=e.fail,a=e.pending,p=e.excludes,f=void 0===p?[o.STATUS.CREATE]:p,d=e.runQueue,l=void 0===d||d,S={key:u},c=this.getStatus(S),y=function(){t.runQueue({key:u,status:c})},h=0;h<f.length;h++){if(f[h]===c)return!1}var v=[this.getData(S)];switch(c){case o.STATUS.CREATE:return this.hook(null,i,v),!0;case o.STATUS.SUCCESS:return this.hook(null,r,v),l&&y(),!0;case o.STATUS.FAIL:return this.hook(null,s,v),l&&y(),!0;case o.STATUS.PENDING:return this.hook(null,a,v),!0;default:return!1}},e.prototype.listen=function(e){var t=this;void 0===e&&(e={});var n=e.key,u=void 0===n?this.key:n,r=e.expire,s=void 0===r?0:r,a=e.success,p=e.fail,f=e.queue,d=void 0===f?[]:f,l=e.queueOptions,S={key:u},c=this.getListen(S),y=function(e,n){n===o.STATUS.SUCCESS?t.hook(null,a,[e]):t.hook(null,p,[e])};if(c){if(c.expire&&c.expireTime<+new Date){var h=this.getQueue(S).queue;return h.length>0&&(e.queue=h),y=null,this.removeListen(S),this.listen(e)}this.getQueue(S).enqueue(y);var v=this.getStatus(S);if(v===o.STATUS.SUCCESS||v===o.STATUS.FAIL)return this;this.setStatus({key:u,status:o.STATUS.PENDING})}else{var T=new i.a(l||this.options.queueOptions);s&&d.length>0&&d.forEach(function(e){T.enqueue(e)}),T.enqueue(y),this.pends[u]={queue:T,status:o.STATUS.CREATE,data:null,expire:s,expireTime:s?+new Date+s:0}}return this},e.prototype.getListen=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t;return this.pends[n]},e.prototype.removeListen=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t;delete this.pends[n]},e.prototype.setData=function(e){var t=e.key,n=void 0===t?this.key:t,u=e.data,i=void 0===u?null:u;return this.getListen({key:n}).data=i},e.prototype.getData=function(e){return void 0===e&&(e={}),this.getListen(e).data},e.prototype.removeData=function(e){void 0===e&&(e={}),this.getListen(e).data=null},e.prototype.getQueue=function(e){return void 0===e&&(e={}),this.getListen(e).queue},e.prototype.setStatus=function(e){var t=e.key,n=void 0===t?this.key:t,u=e.status;this.getListen({key:n}).status=u},e.prototype.getStatus=function(e){return void 0===e&&(e={}),this.getListen(e).status},e.prototype.runQueue=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t,u=e.status,i=void 0===u?o.STATUS.SUCCESS:u;this.getQueue({key:n}).run(this.getData({key:n}),i)},e.prototype.load=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t,u=e.data,i=void 0===u?null:u,r=e.status,s=void 0===r?o.STATUS.SUCCESS:r;s!==o.STATUS.SUCCESS&&s!==o.STATUS.FAIL||(this.setStatus({key:n,status:s}),void 0!==i&&this.setData({key:n,data:i}),this.runQueue({key:n,status:s}))},e.STATUS=o.STATUS,e}();t.default=s},function(t,n){t.exports=e},function(e,t,n){"use strict";var u;n.r(t),n.d(t,"STATUS",function(){return u}),function(e){e.CREATE="CREATE",e.PENDING="PENDING",e.SUCCESS="SUCCESS",e.FAIL="FAIL"}(u||(u={}))}]).default});
//# sourceMappingURL=blue-pend.min.js.map