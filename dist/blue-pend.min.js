/*!
 * 
 * blue-pend.js 1.0.3
 * (c) 2016-2022 Blue
 * Released under the MIT License.
 * https://github.com/azhanging/blue-pend
 * time:Mon, 01 Aug 2022 16:42:53 GMT
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("blue-queue-pipe")):"function"==typeof define&&define.amd?define(["blue-queue-pipe"],t):"object"==typeof exports?exports.BluePend=t(require("blue-queue-pipe")):e.BluePend=t(e.BlueQuePipe)}("undefined"!=typeof self?self:this,function(e){return function(e){var t={};function n(u){if(t[u])return t[u].exports;var o=t[u]={i:u,l:!1,exports:{}};return e[u].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,u){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:u})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var u=Object.create(null);if(n.r(u),Object.defineProperty(u,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(u,o,function(t){return e[t]}.bind(null,o));return u},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="./static",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var u=n(1),o=n.n(u),i=n(2);var r="DEFAULT",s=function(){function e(e){void 0===e&&(e={}),this.options=e,this.key=e.key||r,this.pends={}}return e.prototype.hook=function(e,t,n){return void 0===n&&(n=[]),"function"==typeof t?t.apply(e,n):t},e.prototype.statusHook=function(e){for(var t=this,n=e.key,u=void 0===n?this.key:n,o=e.createHook,r=e.successHook,s=e.failHook,a=e.pendingHook,f=e.excludes,p=void 0===f?[i.STATUS.CREATE]:f,d=e.runQueue,l=void 0===d||d,S={key:u},c=this.getStatus(S),y=function(){t.runQueue({key:u,status:c})},h=0;h<p.length;h++){if(p[h]===c)return!1}var v=[this.getData(S)];switch(c){case i.STATUS.CREATE:return this.hook(null,o,v),!0;case i.STATUS.SUCCESS:return this.hook(null,r,v),l&&y(),!0;case i.STATUS.FAIL:return this.hook(null,s,v),l&&y(),!0;case i.STATUS.PENDING:return this.hook(null,a,v),!0;default:return!1}},e.prototype.listen=function(e){var t=this,n=e.key,u=void 0===n?this.key:n,r=e.expire,s=void 0===r?0:r,a=e.success,f=e.fail,p=e.queue,d=void 0===p?[]:p,l=e.queueOptions,S=void 0===l?{}:l,c={key:u},y=this.getListen(c),h=function(e,n){n===i.STATUS.SUCCESS?t.hook(null,a,[e]):t.hook(null,f,[e])};if(y){if(y.expire&&y.expireTime<+new Date){var v=this.getQueue(c).queue;return v.length>0&&(e.queue=v),h=null,this.removeListen(c),this.listen(e)}this.getQueue(c).enqueue(h);var T=this.getStatus(c);if(T===i.STATUS.SUCCESS||T===i.STATUS.FAIL)return this;this.setStatus({key:u,status:i.STATUS.PENDING})}else{var k=new o.a(S);s&&d.length>0&&d.forEach(function(e){k.enqueue(e)}),k.enqueue(h),this.pends[u]={queue:k,status:i.STATUS.CREATE,data:null,expire:s,expireTime:s?+new Date+s:0}}return this},e.prototype.getListen=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t;return this.pends[n]},e.prototype.removeListen=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t;delete this.pends[n]},e.prototype.setData=function(e){var t=e.key,n=void 0===t?this.key:t,u=e.data,o=void 0===u?null:u;return this.getListen({key:n}).data=o},e.prototype.getData=function(e){return void 0===e&&(e={}),this.getListen(e).data},e.prototype.removeData=function(e){void 0===e&&(e={}),this.getListen(e).data=null},e.prototype.getQueue=function(e){return void 0===e&&(e={}),this.getListen(e).queue},e.prototype.setStatus=function(e){var t=e.key,n=void 0===t?this.key:t,u=e.status;this.getListen({key:n}).status=u},e.prototype.getStatus=function(e){return void 0===e&&(e={}),this.getListen(e).status},e.prototype.runQueue=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t,u=e.status,o=void 0===u?i.STATUS.SUCCESS:u;this.getQueue({key:n}).run(this.getData({key:n}),o)},e.prototype.load=function(e){void 0===e&&(e={});var t=e.key,n=void 0===t?this.key:t,u=e.data,o=void 0===u?null:u,r=e.status,s=void 0===r?i.STATUS.SUCCESS:r;s!==i.STATUS.SUCCESS&&s!==i.STATUS.FAIL||(this.setStatus({key:n,status:s}),void 0!==o&&this.setData({key:n,data:o}),this.runQueue({key:n,status:s}))},e.STATUS=i.STATUS,e}();t.default=s},function(t,n){t.exports=e},function(e,t,n){"use strict";var u;n.r(t),n.d(t,"STATUS",function(){return u}),function(e){e.CREATE="CREATE",e.PENDING="PENDING",e.SUCCESS="SUCCESS",e.FAIL="FAIL"}(u||(u={}))}]).default});
//# sourceMappingURL=blue-pend.min.js.map